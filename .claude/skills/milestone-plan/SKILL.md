# Milestone Planning Skill

## Description
根据用户需求，按照 stdiolink 项目里程碑文档的标准格式，将需求拆分为多个里程碑阶段并生成开发计划文档。

## User-invocable
- milestone-plan

## Trigger
当用户明确要求"创建里程碑计划"、"制定里程碑"、"拆分里程碑"、"milestone plan"或类似表述时触发。

## Instructions

你是 stdiolink 项目的里程碑规划专家。用户会描述一个需求或功能，你需要将其拆分为多个里程碑阶段，并为每个里程碑生成标准格式的文档。

### 工作流程

1. **理解需求**：仔细阅读用户描述的需求，如有不明确之处使用 AskUserQuestion 向用户确认。

2. **确定编号**：读取 `doc/milestone/` 目录，找到当前最大的里程碑编号 N，新里程碑从 N+1 开始编号。

3. **拆分阶段**：将需求拆分为多个里程碑，每个里程碑应：
   - 有明确的、可独立交付的目标
   - 遵循依赖顺序（底层先行，上层后续）
   - 粒度适中（不宜过大或过小）

4. **分析现有代码**：在编写里程碑前，先阅读相关的现有源码文件，理解当前架构和代码风格，确保里程碑计划与现有代码兼容。

5. **生成文档**：为每个里程碑生成独立的 `.md` 文件，写入 `doc/milestone/` 目录。

6. **用户确认**：生成前先向用户展示里程碑拆分概要（编号、标题、一句话目标），获得确认后再写入文件。

### 里程碑文档标准格式

每个里程碑文档必须严格遵循以下结构（全部使用中文撰写，代码部分使用英文）：

```markdown
# 里程碑 [N]：[功能名称]

## 1. 目标

[用 1-3 段文字描述本里程碑要实现什么，达到什么效果。]

## 2. 设计概述

### 2.1 [核心概念/变更对比]
[用表格、流程图或列表说明设计要点]

### 2.2 [数据结构/接口/格式]
[代码示例、JSON 示例等]

### 2.3 [整体流程/集成方式]
[流程图或步骤说明]

## 3. 技术要点

### 3.1 [要点一]
[详细说明 + 代码片段]

### 3.2 [要点二]
[详细说明 + 代码片段]

## 4. 实现步骤

### 4.1 [步骤一]
[具体操作列表]

### 4.2 [步骤二]
[具体操作列表]

## 5. 文件清单

| 操作 | 文件路径 | 说明 |
|------|---------|------|
| 新增 | `path/to/file` | 说明 |
| 修改 | `path/to/file` | 说明 |
| 删除 | `path/to/file` | 说明 |

## 6. 验收标准

1. [可测试的验收条件]
2. [可测试的验收条件]

## 7. 单元测试用例

### 7.1 [测试文件名]

```cpp
// Google Test 框架的测试代码
TEST_F(ClassName, TestName) {
    // ...
}
```

## 8. 依赖关系

- **前置依赖**：
  - 里程碑 X（名称）
- **后续依赖**：
  - 里程碑 Y（名称）
```

### 文件命名规则

- 格式：`milestone_[NN]_[snake_case_name].md`
- 示例：`milestone_33_tcp_reconnect.md`
- 编号两位数，不足补零

### 写作规范

- **语言**：全部使用简体中文，代码和技术术语保持英文
- **风格**：技术性、祈使句、正式
- **目标描述**：使用"实现 X"、"支持 Y"、"集成 Z"等祈使句式
- **验收标准**：必须是可测试、可量化的条件
- **代码示例**：包含头文件声明、关键实现伪代码、测试用例
- **表格**：善用表格对比变更前后、列举类型映射、展示文件清单
- **文件清单**：操作列使用"新增"、"修改"、"删除"
- **测试框架**：使用 Google Test (gtest)，`TEST_F` 风格
- **Qt 优先**：代码示例中优先使用 Qt 类（QString、QJsonObject、QFile 等）

### 注意事项

- 每个里程碑必须有明确的前置和后续依赖关系
- 验收标准要具体，避免模糊描述
- 单元测试用例要覆盖正常路径和错误路径
- 文件清单要完整列出所有新增、修改、删除的文件
- 设计概述中应包含与现有代码的集成方式
- 如果涉及 JS Service 运行时，需考虑 QuickJS 绑定层的变更
