# stdiolink_server WebUI 产品设计文档

**版本：** 1.0  
**日期：** 2026-02-13  
**作者：** 产品设计团队  
**状态：** 设计阶段

---

## 📋 目录

1. [项目概述](#1-项目概述)
2. [系统架构](#2-系统架构)
3. [技术栈规范](#3-技术栈规范)
4. [设计系统](#4-设计系统)
5. [核心功能模块](#5-核心功能模块)
6. [界面布局与交互](#6-界面布局与交互)
7. [特色功能详细设计](#7-特色功能详细设计)
8. [API对接方案](#8-api对接方案)
9. [开发规范](#9-开发规范)
10. [部署方案](#10-部署方案)
11. [附录](#11-附录)

---

## 1. 项目概述

### 1.1 产品定位

stdiolink_server WebUI 是一个**企业级服务编排与管理平台**，为 stdiolink 生态系统提供可视化的管理界面。它通过统一的 Web 界面管理 Services、Projects、Instances 和 Drivers，实现服务的全生命周期管理。

### 1.2 核心价值

- **可视化管理**：将复杂的服务配置、项目编排转化为直观的图形界面
- **实时监控**：提供实时的实例运行状态、资源占用、进程树可视化
- **开发友好**：集成 JavaScript 编辑器、Schema 自动生成、Driver 在线测试
- **生产就绪**：支持服务调度、健康检查、日志管理、事件流

### 1.3 目标用户

- **开发者**：创建和调试 Services 与 Drivers
- **运维人员**：管理 Projects、监控 Instances
- **架构师**：设计服务编排、查看系统状态

### 1.4 设计原则

1. **专业性**：界面设计遵循企业级应用标准，色彩克制、布局清晰
2. **一致性**：统一的设计语言、交互模式、视觉风格
3. **高效性**：减少点击次数，支持键盘快捷键，智能表单验证
4. **可靠性**：实时状态同步、错误处理、操作确认机制

---

## 2. 系统架构

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        Browser Client                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   React UI   │  │  Monaco      │  │  Visualizers │          │
│  │   Components │  │  Editor      │  │  (Charts/    │          │
│  │              │  │              │  │   Trees)     │          │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘          │
│         │                 │                 │                   │
│         └─────────────────┴─────────────────┘                   │
│                           │                                     │
│                  ┌────────▼─────────┐                          │
│                  │  State Manager   │                          │
│                  │  (Redux/Zustand) │                          │
│                  └────────┬─────────┘                          │
│                           │                                     │
│         ┌─────────────────┼─────────────────┐                 │
│         │                 │                 │                 │
│  ┌──────▼───────┐  ┌──────▼───────┐  ┌──────▼───────┐        │
│  │ REST API     │  │  WebSocket   │  │  Server-Sent │        │
│  │ Client       │  │  Client      │  │  Events      │        │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘        │
└─────────┼──────────────────┼──────────────────┼───────────────┘
          │                  │                  │
          │  HTTP/JSON       │  WS              │  SSE
          │                  │                  │
┌─────────▼──────────────────▼──────────────────▼───────────────┐
│                   stdiolink_server Backend                     │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐        │
│  │  API Router  │  │ DriverLab WS │  │  Event Bus   │        │
│  │  (HTTP)      │  │  Handler     │  │  (SSE)       │        │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘        │
│         │                 │                 │                 │
│  ┌──────▼─────────────────▼─────────────────▼───────┐        │
│  │            Server Manager                         │        │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐   │        │
│  │  │ Service    │ │  Project   │ │ Instance   │   │        │
│  │  │ Manager    │ │  Manager   │ │ Manager    │   │        │
│  │  └────────────┘ └────────────┘ └────────────┘   │        │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐   │        │
│  │  │ Schedule   │ │  Process   │ │  Driver    │   │        │
│  │  │ Engine     │ │  Monitor   │ │  Catalog   │   │        │
│  │  └────────────┘ └────────────┘ └────────────┘   │        │
│  └──────────────────────────────────────────────────┘        │
└───────────────────────────────────────────────────────────────┘
```

### 2.2 前后端分离架构

- **前端**：独立的 SPA 应用，通过 API 与后端通信
- **后端**：提供 RESTful API、WebSocket、SSE 三种通信方式
- **数据流**：单向数据流，状态管理集中化

### 2.3 通信协议

| 协议 | 用途 | 特点 |
|------|------|------|
| **HTTP/REST** | CRUD操作、数据查询 | 标准化、易于调试 |
| **WebSocket** | DriverLab实时交互 | 双向通信、低延迟 |
| **Server-Sent Events** | 事件流推送 | 单向推送、自动重连 |

---

## 3. 技术栈规范

### 3.1 前端技术栈

#### 核心框架
- **React 18.3+**：UI 框架
  - 使用 Hooks API
  - 支持 Concurrent Features
  - 严格模式开发

#### 状态管理
- **Zustand 4.x**：轻量级状态管理
  - 比 Redux 更简洁
  - 优秀的 TypeScript 支持
  - 内置 DevTools

#### 路由
- **React Router v6**：客户端路由
  - 声明式路由配置
  - 嵌套路由支持
  - 导航守卫

#### UI 组件库
- **Ant Design 5.x**：企业级 UI 组件
  - 丰富的组件生态
  - 成熟的设计规范
  - 优秀的可访问性
  - 主题定制能力

#### 代码编辑器
- **Monaco Editor**：VS Code 同款编辑器
  - 语法高亮：JavaScript、JSON、YAML
  - 智能提示与补全
  - 多主题支持
  - Diff 对比功能

#### 数据可视化
- **Recharts**：基于 React 的图表库
  - 声明式 API
  - 响应式设计
  - 动画效果

- **React Flow**：流程图/拓扑图
  - 节点/边自定义
  - 交互式布局
  - 缩放与平移

#### 工具库
- **axios**：HTTP 客户端
  - 请求/响应拦截
  - 取消请求支持
  - 自动 JSON 转换

- **date-fns**：日期处理
  - 轻量级
  - 函数式API
  - Tree-shaking 友好

- **clsx**：条件类名合并
- **react-markdown**：Markdown 渲染
- **react-syntax-highlighter**：代码高亮

### 3.2 开发工具链

#### 构建工具
- **Vite 5.x**：现代化构建工具
  - 极快的热更新
  - 原生 ESM 支持
  - 优化的生产构建

#### 类型检查
- **TypeScript 5.x**：静态类型
  - 严格模式
  - 路径别名配置
  - 类型声明文件

#### 代码质量
- **ESLint**：代码检查
  - Airbnb 规则集
  - TypeScript 插件
  - React Hooks 规则

- **Prettier**：代码格式化
  - 统一代码风格
  - 与 ESLint 集成

- **Husky + lint-staged**：Git Hooks
  - 提交前检查
  - 自动格式化

#### 测试
- **Vitest**：单元测试
- **React Testing Library**：组件测试
- **Playwright**：E2E 测试

### 3.3 后端对接

后端已实现，无需修改。前端需对接以下 API：

- Services API：`/api/services/*`
- Projects API：`/api/projects/*`
- Instances API：`/api/instances/*`
- Drivers API：`/api/drivers/*`
- Server API：`/api/server/*`
- Event Stream：`/api/events`
- DriverLab WebSocket：`/ws/driverlab`

---

## 4. 设计系统

### 4.1 视觉风格定位

**现代专业**：干净、清晰、高效

- 扁平化设计，避免过度装饰
- 适度的阴影与圆角
- 流畅的动画过渡
- 响应式布局

### 4.2 色彩方案

#### 主色调（Primary）
```scss
$primary-color: #1890ff;      // 蓝色 - 主要操作
$primary-hover: #40a9ff;      // 悬停态
$primary-active: #096dd9;     // 激活态
$primary-light: #e6f7ff;      // 浅色背景
```

**用途**：按钮、链接、图标、强调元素

#### 辅助色（Secondary）
```scss
$secondary-color: #722ed1;    // 紫色 - 次要操作
$secondary-hover: #9254de;
$secondary-active: #531dab;
```

**用途**：次要按钮、标签、特殊状态

#### 中性色（Neutral）
```scss
$text-primary: #262626;       // 主文本
$text-secondary: #595959;     // 次要文本
$text-tertiary: #8c8c8c;      // 辅助文本
$text-disabled: #bfbfbf;      // 禁用文本

$border-color: #d9d9d9;       // 边框
$divider-color: #f0f0f0;      // 分割线
$background: #ffffff;         // 背景
$background-light: #fafafa;   // 浅背景
$background-dark: #f5f5f5;    // 深背景
```

#### 状态色（Semantic）
```scss
$success-color: #52c41a;      // 成功 - 运行中
$warning-color: #faad14;      // 警告 - 需要注意
$error-color: #f5222d;        // 错误 - 失败
$info-color: #1890ff;         // 信息 - 提示
```

#### 功能色
```scss
$code-bg: #f6f7f9;            // 代码背景
$code-border: #e1e4e8;        // 代码边框
$highlight-bg: #fff3cd;       // 高亮背景
$highlight-border: #ffc107;   // 高亮边框
```

### 4.3 字体规范

#### 字体族
```scss
$font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', 
                   Roboto, 'Helvetica Neue', Arial, sans-serif;
$font-family-code: 'Monaco', 'Menlo', 'Ubuntu Mono', 
                   'Consolas', 'Courier New', monospace;
```

#### 字体大小
```scss
$font-size-xs: 12px;          // 辅助文本
$font-size-sm: 13px;          // 小文本
$font-size-base: 14px;        // 正文
$font-size-lg: 16px;          // 大标题
$font-size-xl: 20px;          // 特大标题
$font-size-xxl: 24px;         // 页面主标题
```

#### 字重
```scss
$font-weight-normal: 400;     // 正常
$font-weight-medium: 500;     // 中等（标题）
$font-weight-semibold: 600;   // 半粗（重要信息）
$font-weight-bold: 700;       // 粗体（强调）
```

### 4.4 间距系统

基于 8px 栅格系统：

```scss
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
$spacing-xl: 32px;
$spacing-xxl: 48px;
```

### 4.5 圆角与阴影

#### 圆角
```scss
$border-radius-sm: 2px;       // 小组件
$border-radius-base: 4px;     // 标准
$border-radius-lg: 8px;       // 卡片
```

#### 阴影
```scss
$box-shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
$box-shadow-base: 0 4px 12px rgba(0, 0, 0, 0.08);
$box-shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
```

### 4.6 动画规范

```scss
$animation-duration-fast: 150ms;
$animation-duration-base: 250ms;
$animation-duration-slow: 400ms;

$easing-base: cubic-bezier(0.4, 0, 0.2, 1);
$easing-in: cubic-bezier(0.4, 0, 1, 1);
$easing-out: cubic-bezier(0, 0, 0.2, 1);
```

---

## 5. 核心功能模块

### 5.1 Dashboard（仪表盘）

#### 功能概述
提供系统全局概览，快速了解服务运行状态。

#### 核心指标卡片（Grid 布局）

```
┌─────────────────────────────────────────────────────────┐
│  📊 Dashboard                              [刷新] [设置] │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐ │
│  │ Services │  │ Projects │  │ Instances│  │ Drivers │ │
│  │   12     │  │    8     │  │    5     │  │   18    │ │
│  │ ▲ +2     │  │ ⚡ 3 启用 │  │ ✓ 运行中 │  │ 📦 活跃 │ │
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘ │
│                                                          │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 📈 资源使用情况 (近1小时)                        │   │
│  │                                                  │   │
│  │  CPU: ████████░░  78%                           │   │
│  │  内存: ██████░░░░  62%                           │   │
│  │  进程: 23 个                                     │   │
│  │                                                  │   │
│  │  [折线图：CPU/内存趋势]                         │   │
│  └─────────────────────────────────────────────────┘   │
│                                                          │
│  ┌──────────────────┐  ┌──────────────────────────┐   │
│  │ 🔥 活跃实例      │  │ 📝 最近事件              │   │
│  │                  │  │                          │   │
│  │ • proj-api (5m) │  │ 10:23 Instance Started  │   │
│  │ • proj-worker   │  │ 10:15 Project Updated   │   │
│  │ • proj-scheduler│  │ 09:58 Service Deployed  │   │
│  │                  │  │ 09:42 Health Check OK   │   │
│  │ [查看全部]       │  │ [查看全部]              │   │
│  └──────────────────┘  └──────────────────────────┘   │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 实现要点

1. **实时数据**：通过 SSE 接收事件更新
2. **趋势图表**：使用 Recharts 绘制资源趋势
3. **卡片交互**：点击跳转到对应模块
4. **自动刷新**：30s 自动刷新数据（可配置）

#### API 需求

```
GET /api/server/status
GET /api/server/stats         # 需要新增
GET /api/instances
GET /api/projects
GET /api/services
GET /api/events (SSE)
```

### 5.2 Services（服务管理）

#### 功能概述
管理 Service 的完整生命周期：创建、编辑、删除、扫描。

#### 界面结构

**列表视图**
```
┌─────────────────────────────────────────────────────────┐
│  📦 Services                    [+ 新建] [🔄 扫描目录]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  🔍 [搜索框]     [类型: 全部 ▼] [状态: 全部 ▼]         │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID          │ 名称        │ 版本  │ 项目数 │ 操作  │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ api-service │ API服务     │ 1.2.0 │ 3      │ [...]│ │
│  │ worker-svc  │ 任务处理器  │ 2.0.1 │ 2      │ [...]│ │
│  │ scheduler   │ 调度器      │ 1.0.0 │ 1      │ [...]│ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  显示 1-3 / 共 12 条                      [1] 2 3 ... │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**详情视图**
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Service: api-service                 [删除]  │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [概览] [文件] [Schema] [项目引用]                      │
│  ━━━━━                                                   │
│                                                          │
│  基本信息                                                │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID:           api-service                          │ │
│  │ 名称:         API 服务                             │ │
│  │ 版本:         1.2.0                                │ │
│  │ 描述:         提供RESTful API服务                  │ │
│  │ 入口脚本:     index.js                             │ │
│  │ 创建时间:     2026-01-15 10:23:45                  │ │
│  │ 最后修改:     2026-02-10 14:32:11                  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  配置 Schema                                             │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 字段             │ 类型    │ 必填 │ 默认值          │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ port            │ Int     │ ✓   │ 8080            │ │
│  │ database.host   │ String  │ ✓   │ localhost       │ │
│  │ database.port   │ Int     │     │ 5432            │ │
│  │ log.level       │ Enum    │     │ info            │ │
│  │ cache.enabled   │ Bool    │     │ true            │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  [导出 Schema JSON]  [验证配置]                         │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 创建/编辑服务流程

**步骤1：选择创建方式**
```
┌─────────────────────────────────────────────┐
│  创建 Service                        [×]    │
├─────────────────────────────────────────────┤
│                                             │
│  选择创建方式:                              │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📝 手动创建                         │   │
│  │  从头开始编写脚本和Schema            │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📂 从目录扫描                       │   │
│  │  扫描现有服务目录                    │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  📋 从模板创建                       │   │
│  │  使用预定义模板快速创建              │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

**步骤2：基本信息**
```
┌─────────────────────────────────────────────┐
│  创建 Service - 基本信息            [上一步] │
├─────────────────────────────────────────────┤
│                                             │
│  Service ID *                               │
│  ┌───────────────────────────────────────┐ │
│  │ api-service                           │ │
│  └───────────────────────────────────────┘ │
│  ⓘ 小写字母、数字、连字符，不可修改        │
│                                             │
│  名称 *                                     │
│  ┌───────────────────────────────────────┐ │
│  │ API 服务                              │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  版本                                       │
│  ┌───────────────────────────────────────┐ │
│  │ 1.0.0                                 │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  描述                                       │
│  ┌───────────────────────────────────────┐ │
│  │                                       │ │
│  │                                       │ │
│  └───────────────────────────────────────┘ │
│                                             │
│              [取消]      [下一步：编写脚本] │
│                                             │
└─────────────────────────────────────────────┘
```

**步骤3：脚本编辑器**
```
┌─────────────────────────────────────────────────────────┐
│  创建 Service - 编写脚本                        [上一步] │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  index.js  [保存] [格式化] [验证语法]                   │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 1  // Service entry point                         │ │
│  │ 2  import { Driver } from 'stdiolink';            │ │
│  │ 3  import { createLogger } from 'stdiolink/log';  │ │
│  │ 4                                                  │ │
│  │ 5  const logger = createLogger({                  │ │
│  │ 6    service: 'api-service'                       │ │
│  │ 7  });                                             │ │
│  │ 8                                                  │ │
│  │ 9  export async function main(config) {           │ │
│  │10    logger.info('Service starting...', config);  │ │
│  │11                                                  │ │
│  │12    // Your service logic here                   │ │
│  │13                                                  │ │
│  │14  }                                               │ │
│  │                                                    │ │
│  │                                                    │ │
│  │                                                    │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  Monaco Editor Features:                                │
│  • 语法高亮 (JavaScript)                                │
│  • 智能提示 (stdiolink API)                             │
│  • 错误标记                                             │
│  • 代码折叠                                             │
│  • 快捷键: Ctrl+S 保存, Ctrl+Shift+F 格式化             │
│                                                          │
│              [取消]      [下一步：配置Schema]            │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**步骤4：Schema 编辑器**
```
┌─────────────────────────────────────────────────────────┐
│  创建 Service - 配置Schema                      [上一步] │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [可视化编辑器] [JSON 编辑器]                           │
│  ━━━━━━━━━━━━━                                           │
│                                                          │
│  Schema 字段                              [+ 添加字段]   │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 字段名称        │ 类型    │ 必填 │ 默认值   │ 操作 │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ port           │ Int  ▼ │ ☑   │ 8080     │ ✎ × │ │
│  │ database.host  │ String▼│ ☑   │ localhost│ ✎ × │ │
│  │ database.port  │ Int  ▼ │ ☐   │ 5432     │ ✎ × │ │
│  │ log.level      │ Enum ▼ │ ☐   │ info     │ ✎ × │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  字段详情 - port                                         │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 类型:     [Int ▼]                                  │ │
│  │ 必填:     ☑ 必填                                    │ │
│  │ 默认值:   [8080]                                    │ │
│  │ 描述:     服务监听端口                              │ │
│  │                                                     │ │
│  │ 约束条件:                                           │ │
│  │ 最小值:   [1]       最大值: [65535]                │ │
│  │                                                     │ │
│  │ UI 提示:                                            │ │
│  │ 组件:     [NumberInput ▼]                          │ │
│  │ 分组:     [网络配置]                                │ │
│  │ 排序:     [1]                                       │ │
│  │ 占位符:   [请输入端口号]                            │ │
│  │ 高级:     ☐ 仅高级模式显示                          │ │
│  │                                                     │ │
│  │                     [保存] [取消]                   │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  配置注入方式                                            │
│  ● StartupArgs  ○ Environment  ○ ConfigFile  ○ Command │
│                                                          │
│  [验证 Schema]  [导出 JSON]                             │
│                                                          │
│              [取消]      [完成创建]                      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 文件管理

**文件浏览器**
```
┌─────────────────────────────────────────────┐
│  文件 - api-service            [+ 新建文件] │
├─────────────────────────────────────────────┤
│                                             │
│  📁 api-service/                            │
│    📄 index.js            ✅ 核心文件       │
│    📄 schema.json         ✅ 核心文件       │
│    📄 package.json                          │
│    📁 lib/                                  │
│      📄 database.js                         │
│      📄 router.js                           │
│    📄 README.md                             │
│                                             │
│  ⚠️ 核心文件受保护，修改需谨慎               │
│                                             │
└─────────────────────────────────────────────┘
```

**文件编辑**
- 支持在线编辑
- 语法高亮
- 自动保存
- 版本对比（可选）

### 5.3 Projects（项目管理）

#### 功能概述
项目是服务的实例配置，定义了服务如何运行（配置参数、调度策略）。

#### 列表视图
```
┌─────────────────────────────────────────────────────────┐
│  🗂️ Projects                                  [+ 新建]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  🔍 [搜索]  [Service: 全部▼] [状态: 全部▼] [启用: 全部▼] │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID        │ 名称    │ Service│ 状态  │ 启用 │ 操作 │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ proj-api  │ API生产 │ api-svc│ ●运行 │ ✓   │ [...] │ │
│  │ proj-work │ 任务处理│ worker │ ●运行 │ ✓   │ [...] │ │
│  │ proj-sch  │ 调度器  │ sched  │ ○停止 │ ✗   │ [...] │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  状态图例:  ● 运行中  ○ 已停止  ◐ 启动中  ◑ 重启中      │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 创建项目流程

**步骤1：选择服务**
```
┌─────────────────────────────────────────────┐
│  创建 Project                        [×]    │
├─────────────────────────────────────────────┤
│                                             │
│  选择 Service *                             │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │ 🔍 搜索服务...                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │ ○ api-service                         │ │
│  │   API 服务 (v1.2.0)                   │ │
│  │   提供RESTful API服务                 │ │
│  │                                       │ │
│  │ ○ worker-service                      │ │
│  │   任务处理器 (v2.0.1)                 │ │
│  │   异步任务处理                        │ │
│  │                                       │ │
│  │ ○ scheduler-service                   │ │
│  │   调度器 (v1.0.0)                     │ │
│  │   定时任务调度                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│              [取消]         [下一步]        │
│                                             │
└─────────────────────────────────────────────┘
```

**步骤2：基本信息**
```
┌─────────────────────────────────────────────┐
│  创建 Project - 基本信息            [上一步] │
├─────────────────────────────────────────────┤
│                                             │
│  Service: api-service (v1.2.0)              │
│                                             │
│  Project ID *                               │
│  ┌───────────────────────────────────────┐ │
│  │ proj-api-prod                         │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  名称 *                                     │
│  ┌───────────────────────────────────────┐ │
│  │ API 生产环境                          │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  启用                                       │
│  ☑ 创建后立即启用项目                       │
│                                             │
│              [取消]  [下一步：配置参数]     │
│                                             │
└─────────────────────────────────────────────┘
```

**步骤3：配置参数（自动生成表单）**
```
┌─────────────────────────────────────────────────────────┐
│  创建 Project - 配置参数                        [上一步] │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  基于 api-service 的 Schema 自动生成配置表单             │
│                                                          │
│  ┌─ 网络配置 ─────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  端口 *                                             │ │
│  │  ┌─────────────────┐                               │ │
│  │  │ 8080            │  (默认: 8080, 范围: 1-65535)  │ │
│  │  └─────────────────┘                               │ │
│  │                                                     │ │
│  │  主机地址 *                                         │ │
│  │  ┌─────────────────┐                               │ │
│  │  │ 0.0.0.0         │  (默认: 0.0.0.0)              │ │
│  │  └─────────────────┘                               │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌─ 数据库配置 ───────────────────────────────────────┐ │
│  │                                                     │ │
│  │  数据库主机 *                                       │ │
│  │  ┌─────────────────┐                               │ │
│  │  │ db.example.com  │                               │ │
│  │  └─────────────────┘                               │ │
│  │                                                     │ │
│  │  数据库端口                                         │ │
│  │  ┌─────────────────┐                               │ │
│  │  │ 5432            │  (默认: 5432)                 │ │
│  │  └─────────────────┘                               │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌─ 日志配置 ─────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  日志级别                                           │ │
│  │  ● info  ○ debug  ○ warn  ○ error                 │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
│  ☐ 显示高级选项                                         │
│                                                          │
│  [验证配置]  [重置为默认值]                             │
│                                                          │
│              [取消]  [下一步：调度策略]                  │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### Schema 到 UI 的映射规则

| Schema 字段类型 | UI 组件 | 说明 |
|----------------|---------|------|
| String | Input | 单行文本框 |
| Int / Int64 | InputNumber | 数字输入，带范围限制 |
| Double | InputNumber | 浮点数输入，带步进值 |
| Bool | Checkbox / Switch | 开关 |
| Enum | Radio / Select | 枚举选择 |
| Object | Collapse Panel | 嵌套对象展开 |
| Array | Dynamic List | 动态添加/删除 |

**UI Hint 增强**
- `widget`: 指定组件类型（覆盖默认映射）
- `group`: 分组标题
- `order`: 字段排序
- `placeholder`: 占位符文本
- `advanced`: 高级选项折叠
- `visibleIf`: 条件显示（表达式）
- `unit`: 单位标签

**步骤4：调度策略**
```
┌─────────────────────────────────────────────┐
│  创建 Project - 调度策略            [上一步] │
├─────────────────────────────────────────────┤
│                                             │
│  调度类型 *                                 │
│                                             │
│  ● Manual (手动)                            │
│    手动启动和停止                           │
│                                             │
│  ○ Daemon (守护进程)                        │
│    持续运行，异常退出自动重启                │
│                                             │
│  ○ FixedRate (固定频率)                     │
│    定时执行任务                             │
│                                             │
│  ┌─ Daemon 配置 ──────────────────────────┐ │
│  │                                         │ │
│  │  重启延迟 (ms)                          │ │
│  │  ┌───────────────┐                     │ │
│  │  │ 3000          │                     │ │
│  │  └───────────────┘                     │ │
│  │                                         │ │
│  │  最大连续失败次数                        │ │
│  │  ┌───────────────┐                     │ │
│  │  │ 5             │                     │ │
│  │  └───────────────┘                     │ │
│  │                                         │ │
│  │  ⓘ 超过最大失败次数后停止自动重启        │ │
│  │                                         │ │
│  └─────────────────────────────────────────┘ │
│                                             │
│              [取消]         [完成创建]      │
│                                             │
└─────────────────────────────────────────────┘
```

#### 项目详情页

```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Project: proj-api-prod                       │
│                                  [▶ 启动] [■ 停止] [更多]│
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [概览] [配置] [实例] [日志] [调度]                      │
│  ━━━━━                                                   │
│                                                          │
│  基本信息                                                │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID:           proj-api-prod                        │ │
│  │ 名称:         API 生产环境                         │ │
│  │ Service:      api-service (v1.2.0)                 │ │
│  │ 状态:         ● 运行中                             │ │
│  │ 启用:         ✓ 已启用                             │ │
│  │ 调度类型:     Daemon                               │ │
│  │ 创建时间:     2026-01-20 09:15:32                  │ │
│  │ 最后更新:     2026-02-12 16:42:18                  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  运行时信息                                              │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 当前实例:     instance-abc123                      │ │
│  │ 进程 PID:     12345                                │ │
│  │ 运行时长:     2天 5小时 23分钟                      │ │
│  │ 重启次数:     0                                     │ │
│  │ 连续失败:     0 / 5                                │ │
│  │                                                     │ │
│  │ 资源占用:                                           │ │
│  │   CPU:  ███░░░░░░░  12.3%                          │ │
│  │   内存: ██████░░░░  256 MB                         │ │
│  │   进程: 3 个                                        │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  配置摘要                                                │
│  ┌────────────────────────────────────────────────────┐ │
│  │ port:           8080                               │ │
│  │ database.host:  db.example.com                     │ │
│  │ database.port:  5432                               │ │
│  │ log.level:      info                               │ │
│  │                                                     │ │
│  │ [查看完整配置]  [编辑配置]                          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 5.4 Instances（实例管理）

#### 功能概述
实例是 Project 的运行进程，提供实时监控、日志查看、进程树可视化。

#### 列表视图
```
┌─────────────────────────────────────────────────────────┐
│  🚀 Instances                      [刷新] [终止所有]     │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  🔍 [搜索]  [Project: 全部▼] [状态: 全部▼]              │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID       │ Project │ Service│ 状态│ CPU│ 内存│ 操作│ │
│  ├────────────────────────────────────────────────────┤ │
│  │ inst-001 │ api-prod│ api-svc│ ●运行│12% │256M│[...] │ │
│  │ inst-002 │ worker  │ worker │ ●运行│ 8% │128M│[...] │ │
│  │ inst-003 │ api-dev │ api-svc│ ○停止│ 0% │ 0M │[...] │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 实例详情 - 进程树可视化

```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Instance: instance-abc123           [终止]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [概览] [进程树] [日志] [资源]                          │
│         ━━━━━━━                                          │
│                                                          │
│  进程树 (实时更新)                              [刷新]   │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  ┌─ PID 12345: node index.js ─────────────────────┐│ │
│  │  │  CPU: 12.3%  内存: 256MB  线程: 8              ││ │
│  │  │  运行时长: 2d 5h 23m                           ││ │
│  │  │                                                 ││ │
│  │  │  ├─ PID 12346: node worker.js                  ││ │
│  │  │  │  CPU: 3.2%   内存: 64MB   线程: 4           ││ │
│  │  │  │                                              ││ │
│  │  │  ├─ PID 12347: node worker.js                  ││ │
│  │  │  │  CPU: 2.8%   内存: 58MB   线程: 4           ││ │
│  │  │  │                                              ││ │
│  │  │  └─ PID 12348: node logger.js                  ││ │
│  │  │     CPU: 0.1%   内存: 16MB   线程: 2           ││ │
│  │  │                                                 ││ │
│  │  └─────────────────────────────────────────────────┘│ │
│  │                                                     │ │
│  │  汇总统计:                                          │ │
│  │  • 总进程数: 4                                      │ │
│  │  • 总 CPU: 18.4%                                   │ │
│  │  • 总内存: 394 MB                                  │ │
│  │  • 总线程: 18                                      │ │
│  │                                                     │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  [导出进程树]  [终止全部子进程]                         │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

**实现要点**
- 使用树形结构递归渲染
- 实时更新（WebSocket 或轮询）
- 颜色编码：CPU > 80% 红色警告
- 可折叠/展开节点
- 支持导出 JSON/CSV

#### 实例详情 - 资源监控

```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Instance: instance-abc123                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [概览] [进程树] [日志] [资源]                          │
│                         ━━━━━                            │
│                                                          │
│  资源使用趋势 (近1小时)                     [时间范围▼]  │
│  ┌────────────────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  CPU 使用率 (%)                                    │ │
│  │  100│                                              │ │
│  │   80│                                              │ │
│  │   60│                                              │ │
│  │   40│                                              │ │
│  │   20│        ╱╲    ╱╲                             │ │
│  │    0├────────────────────────────────────────────► │ │
│  │     10:00  10:15  10:30  10:45  11:00             │ │
│  │                                                     │ │
│  │  内存使用 (MB)                                     │ │
│  │  512│                                              │ │
│  │  384│                       ┌────────┐            │ │
│  │  256│        ┌──────────────┘        └──────┐    │ │
│  │  128│  ┌─────┘                              └──  │ │
│  │    0├────────────────────────────────────────────► │ │
│  │     10:00  10:15  10:30  10:45  11:00             │ │
│  │                                                     │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  实时指标                                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ CPU         │  │ 内存        │  │ 线程        │    │
│  │ 12.3%       │  │ 256 MB      │  │ 8           │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ I/O 读      │  │ I/O 写      │  │ 运行时长    │    │
│  │ 1.2 MB/s    │  │ 0.8 MB/s    │  │ 2d 5h 23m   │    │
│  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 实例详情 - 日志查看器

```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Instance: instance-abc123                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [概览] [进程树] [日志] [资源]                          │
│                  ━━━━━                                   │
│                                                          │
│  日志                                                    │
│  ┌────────────────────────────────────────────────────┐ │
│  │ [级别: 全部▼] [搜索...] 🔄 [自动滚动☑] [清空] [导出]│ │
│  ├────────────────────────────────────────────────────┤ │
│  │ 11:23:45.123 INFO  Service started on port 8080   │ │
│  │ 11:23:46.234 DEBUG Connected to database           │ │
│  │ 11:24:01.456 INFO  GET /api/users - 200 (42ms)    │ │
│  │ 11:24:05.789 WARN  Slow query detected (1.2s)     │ │
│  │ 11:24:12.345 INFO  POST /api/orders - 201 (18ms)  │ │
│  │ 11:24:15.678 ERROR Connection timeout             │ │
│  │   at Database.connect (db.js:45:12)               │ │
│  │   at processTicksAndRejections (internal/...)     │ │
│  │ 11:24:20.901 INFO  Reconnected to database        │ │
│  │                                                     │ │
│  │ ▼ 实时更新中...                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  特性:                                                   │
│  • 日志级别过滤 (INFO/DEBUG/WARN/ERROR)                │
│  • 全文搜索（高亮匹配）                                  │
│  • 自动滚动到底部（可关闭）                              │
│  • 颜色编码（ERROR 红色、WARN 橙色等）                  │
│  • 导出日志文件（JSON/TXT）                             │
│  • 查看历史日志（分页加载）                              │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### 5.5 Drivers（驱动管理）

#### 功能概述
管理 Driver 目录、查看元数据、在线测试。

#### 列表视图
```
┌─────────────────────────────────────────────────────────┐
│  🔌 Drivers                             [扫描目录]       │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  🔍 [搜索]  [类型: 全部▼] [Capabilities: 全部▼]         │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID          │ 名称        │ 版本  │ 命令数 │ 操作  │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ calc-driver │ 计算器      │ 1.0.0 │ 4      │ [...]│ │
│  │ file-driver │ 文件操作    │ 2.1.0 │ 8      │ [...]│ │
│  │ db-driver   │ 数据库      │ 1.5.2 │ 12     │ [...]│ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### Driver 详情
```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    Driver: calc-driver                 [测试]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  [元数据] [命令] [文档]                                  │
│  ━━━━━━━                                                 │
│                                                          │
│  基本信息                                                │
│  ┌────────────────────────────────────────────────────┐ │
│  │ ID:           calc-driver                          │ │
│  │ 名称:         计算器驱动                            │ │
│  │ 版本:         1.0.0                                │ │
│  │ 描述:         提供基础数学计算功能                  │ │
│  │ 厂商:         Example Inc.                         │ │
│  │ 入口:         ./calc --stdio                       │ │
│  │ Capabilities: math, async                          │ │
│  │ Profiles:     oneshot, keepalive                   │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  支持的命令 (4)                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ 命令名称    │ 描述              │ 参数数 │ 操作    │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ add         │ 两数相加          │ 2      │ [测试]  │ │
│  │ subtract    │ 两数相减          │ 2      │ [测试]  │ │
│  │ multiply    │ 两数相乘          │ 2      │ [测试]  │ │
│  │ divide      │ 两数相除          │ 2      │ [测试]  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  配置 Schema                                             │
│  ┌────────────────────────────────────────────────────┐ │
│  │ precision     │ Int    │ 小数精度    │ 默认: 2     │ │
│  │ mode          │ Enum   │ 计算模式    │ 默认: fast  │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  [导出元数据 JSON]  [查看文档]                          │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 界面布局与交互

### 6.1 整体布局结构

采用经典的**左侧导航 + 顶部栏 + 主内容区**布局。

```
┌─────────────────────────────────────────────────────────┐
│  [LOGO] stdiolink                    [👤 Admin] [设置]  │ ← 顶部栏 (64px)
├────────┬────────────────────────────────────────────────┤
│        │                                                 │
│  📊    │  主内容区                                       │
│  仪表盘 │                                                 │
│        │  ┌───────────────────────────────────────────┐ │
│  📦    │  │                                           │ │
│  服务  │  │  根据模块不同，展示不同的页面内容          │
│        │  │                                           │ │
│  🗂️    │  │                                           │ │
│  项目  │  └───────────────────────────────────────────┘ │
│        │                                                 │
│  🚀    │                                                 │
│  实例  │                                                 │
│        │                                                 │
│  🔌    │                                                 │
│  驱动  │                                                 │
│        │                                                 │
│  🧪    │                                                 │
│  测试  │                                                 │
│        │                                                 │
│  ━━━━━ │                                                 │
│        │                                                 │
│  📊    │                                                 │
│  监控  │                                                 │
│        │                                                 │
│  📋    │                                                 │
│  日志  │                                                 │
│        │                                                 │
│  ⚙️    │                                                 │
│  设置  │                                                 │
│        │                                                 │
└────────┴─────────────────────────────────────────────────┘
  ↑
  侧边栏 (200px 可折叠)
```

### 6.2 顶部栏（Header）

**组成部分**
- Logo + 产品名称（左侧）
- 全局搜索（中间）
- 用户信息 + 设置（右侧）

**样式规范**
```scss
.header {
  height: 64px;
  background: #ffffff;
  border-bottom: 1px solid #f0f0f0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  padding: 0 24px;
  
  .logo {
    font-size: 20px;
    font-weight: 600;
    color: #262626;
  }
  
  .search {
    max-width: 500px;
    margin: 0 auto;
  }
  
  .user-menu {
    display: flex;
    align-items: center;
    gap: 16px;
  }
}
```

### 6.3 侧边导航（Sidebar）

**导航项结构**
```typescript
const navigation = [
  {
    key: 'dashboard',
    icon: <DashboardOutlined />,
    label: '仪表盘',
    path: '/dashboard'
  },
  {
    key: 'services',
    icon: <AppstoreOutlined />,
    label: '服务',
    path: '/services'
  },
  {
    key: 'projects',
    icon: <FolderOutlined />,
    label: '项目',
    path: '/projects',
    badge: 3 // 运行中数量
  },
  {
    key: 'instances',
    icon: <RocketOutlined />,
    label: '实例',
    path: '/instances',
    badge: 5
  },
  {
    key: 'drivers',
    icon: <ApiOutlined />,
    label: '驱动',
    path: '/drivers'
  },
  { type: 'divider' },
  {
    key: 'driverlab',
    icon: <ExperimentOutlined />,
    label: 'DriverLab',
    path: '/driverlab'
  },
  { type: 'divider' },
  {
    key: 'monitoring',
    icon: <AreaChartOutlined />,
    label: '监控',
    path: '/monitoring'
  },
  {
    key: 'logs',
    icon: <FileTextOutlined />,
    label: '日志',
    path: '/logs'
  },
  {
    key: 'settings',
    icon: <SettingOutlined />,
    label: '设置',
    path: '/settings'
  }
];
```

**交互行为**
- 悬停高亮
- 选中状态（左侧蓝色边框）
- 折叠模式（仅显示图标）
- Badge 显示（实时更新）

### 6.4 主内容区（Content）

**布局规范**
```scss
.content-wrapper {
  padding: 24px;
  min-height: calc(100vh - 64px);
  background: #f5f5f5;
  
  .page-header {
    margin-bottom: 24px;
    background: #ffffff;
    padding: 16px 24px;
    border-radius: 4px;
    
    h1 {
      font-size: 24px;
      font-weight: 600;
      margin: 0;
    }
    
    .actions {
      float: right;
    }
  }
  
  .content-body {
    background: #ffffff;
    padding: 24px;
    border-radius: 4px;
    min-height: 400px;
  }
}
```

### 6.5 响应式设计

**断点定义**
```scss
$breakpoint-xs: 480px;   // 手机
$breakpoint-sm: 768px;   // 平板竖屏
$breakpoint-md: 992px;   // 平板横屏
$breakpoint-lg: 1200px;  // 桌面
$breakpoint-xl: 1600px;  // 大屏幕
```

**适配策略**
- **< 768px**: 侧边栏隐藏，通过抽屉打开
- **768px - 992px**: 侧边栏折叠（仅图标）
- **> 992px**: 完整侧边栏

### 6.6 交互模式

#### 表格操作
- 行悬停高亮
- 行选择（复选框）
- 批量操作（顶部工具栏）
- 行内操作（下拉菜单）
- 分页（10/20/50/100 每页）

#### 表单验证
- 实时验证（失焦时）
- 错误提示（字段下方）
- 必填标记（红色星号）
- 提交前整体校验

#### 确认对话框
- 危险操作（删除、终止）必须确认
- 显示操作影响范围
- 支持二次确认（输入名称）

#### 通知提示
- 成功：绿色 Toast（右上角，3s 自动消失）
- 错误：红色 Modal（手动关闭）
- 警告：橙色 Toast（5s 自动消失）
- 信息：蓝色 Toast（3s 自动消失）

---

## 7. 特色功能详细设计

### 7.1 Service 创建器（高级编辑器）

#### 功能亮点
- **Monaco Editor 集成**：VS Code 同款编辑器
- **语法检查**：实时 ESLint 检查
- **智能提示**：stdiolink API 自动补全
- **多文件编辑**：Tab 切换文件

#### 编辑器配置
```typescript
const monacoOptions = {
  language: 'javascript',
  theme: 'vs-dark', // 或 'vs-light'
  fontSize: 14,
  minimap: { enabled: true },
  automaticLayout: true,
  formatOnPaste: true,
  formatOnType: true,
  suggest: {
    snippetsPreventQuickSuggestions: false
  },
  quickSuggestions: {
    other: true,
    comments: false,
    strings: true
  }
};
```

#### 代码片段（Snippets）
```typescript
const snippets = [
  {
    label: 'stdiolink-service-template',
    insertText: `import { Driver } from 'stdiolink';
import { createLogger } from 'stdiolink/log';

const logger = createLogger({ service: '\${1:service-name}' });

export async function main(config) {
  logger.info('Service starting...', config);
  
  \${2:// Your service logic}
  
  logger.info('Service started successfully');
}`,
    documentation: 'Basic service template'
  },
  {
    label: 'stdiolink-driver-usage',
    insertText: `import { openDriver } from 'stdiolink';

const driver = openDriver('\${1:driver-path}', {
  config: \${2:{}}
});

const result = await driver.\${3:commandName}(\${4:params});
driver.$close();`,
    documentation: 'Use a driver'
  }
];
```

### 7.2 Schema 可视化编辑器

#### 设计理念
- 降低 JSON Schema 编写门槛
- 所见即所得
- 双向同步（可视化 ↔ JSON）

#### 字段编辑面板
```
┌─────────────────────────────────────────────┐
│  编辑字段                            [×]    │
├─────────────────────────────────────────────┤
│                                             │
│  字段名称 *                                 │
│  ┌───────────────────────────────────────┐ │
│  │ database.connection.pool.max          │ │
│  └───────────────────────────────────────┘ │
│  ⓘ 使用点分隔表示嵌套对象                   │
│                                             │
│  类型 *                                     │
│  ┌───────────────────────────────────────┐ │
│  │ Int                               ▼  │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  必填    ☑ 此字段为必填项                   │
│                                             │
│  默认值                                     │
│  ┌───────────────────────────────────────┐ │
│  │ 10                                    │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  描述                                       │
│  ┌───────────────────────────────────────┐ │
│  │ 数据库连接池最大连接数                 │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌─ 约束条件 ─────────────────────────────┐│
│  │                                         ││
│  │  最小值   ┌───────┐  最大值 ┌───────┐  ││
│  │          │ 1     │        │ 100   │  ││
│  │          └───────┘        └───────┘  ││
│  │                                         ││
│  └─────────────────────────────────────────┘│
│                                             │
│  ┌─ UI 提示 ──────────────────────────────┐│
│  │                                         ││
│  │  组件类型  ┌──────────────────────┐    ││
│  │           │ NumberInput       ▼ │    ││
│  │           └──────────────────────┘    ││
│  │                                         ││
│  │  分组      ┌──────────────────────┐    ││
│  │           │ 数据库配置            │    ││
│  │           └──────────────────────┘    ││
│  │                                         ││
│  │  排序      ┌─────┐                     ││
│  │           │ 1   │                     ││
│  │           └─────┘                     ││
│  │                                         ││
│  │  占位符    ┌──────────────────────┐    ││
│  │           │ 请输入最大连接数      │    ││
│  │           └──────────────────────┘    ││
│  │                                         ││
│  │  单位      ┌──────────────────────┐    ││
│  │           │ 个                    │    ││
│  │           └──────────────────────┘    ││
│  │                                         ││
│  │  高级选项  ☐ 仅在高级模式显示           ││
│  │                                         ││
│  │  条件显示  ┌──────────────────────┐    ││
│  │           │ config.mode === 'pro'│    ││
│  │           └──────────────────────┘    ││
│  │  ⓘ 表达式，满足条件时显示此字段          ││
│  │                                         ││
│  └─────────────────────────────────────────┘│
│                                             │
│              [取消]         [保存]          │
│                                             │
└─────────────────────────────────────────────┘
```

#### JSON 编辑器同步
- 切换到 JSON 标签时，显示完整 schema.json
- 支持直接编辑 JSON
- 保存时自动验证并同步到可视化视图
- 错误提示（行号 + 错误信息）

### 7.3 DriverLab（在线测试工具）

#### 功能概述
类似于 Postman，但专门用于测试 stdiolink Drivers。

#### 界面布局
```
┌─────────────────────────────────────────────────────────┐
│  🧪 DriverLab                        [新建会话] [历史]   │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌─ 会话配置 ─────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  选择 Driver *                                      │ │
│  │  ┌─────────────────────────────────────────────┐   │ │
│  │  │ calc-driver (计算器驱动)                ▼  │   │ │
│  │  └─────────────────────────────────────────────┘   │ │
│  │                                                     │ │
│  │  运行模式                                           │ │
│  │  ● OneShot  ○ KeepAlive                           │ │
│  │  ⓘ OneShot: 每次调用重启进程                       │ │
│  │  ⓘ KeepAlive: 保持进程，多次调用                   │ │
│  │                                                     │ │
│  │  额外参数                                           │ │
│  │  ┌─────────────────────────────────────────────┐   │ │
│  │  │ --verbose --timeout=30                      │   │ │
│  │  └─────────────────────────────────────────────┘   │ │
│  │                                                     │ │
│  │               [连接] [断开]                         │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
│  状态: ● 已连接  会话ID: ws-abc123  运行时长: 00:02:34  │
│                                                          │
│  ┌─ 命令调用 ─────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  选择命令 *                                         │ │
│  │  ┌─────────────────────────────────────────────┐   │ │
│  │  │ add (两数相加)                          ▼  │   │ │
│  │  └─────────────────────────────────────────────┘   │ │
│  │                                                     │ │
│  │  参数（根据 meta 自动生成）                         │ │
│  │  ┌───────────────────────────────────────────────┐ │ │
│  │  │ {                                             │ │ │
│  │  │   "a": 10,                                    │ │ │
│  │  │   "b": 20                                     │ │ │
│  │  │ }                                             │ │ │
│  │  └───────────────────────────────────────────────┘ │ │
│  │                                                     │ │
│  │               [执行] [清空结果]                     │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌─ 执行结果 ─────────────────────────────────────────┐ │
│  │                                                     │ │
│  │  状态: done  耗时: 15ms                            │ │
│  │                                                     │ │
│  │  ┌───────────────────────────────────────────────┐ │ │
│  │  │ {                                             │ │ │
│  │  │   "result": 30                                │ │ │
│  │  │ }                                             │ │ │
│  │  └───────────────────────────────────────────────┘ │ │
│  │                                                     │ │
│  │  事件流:                                            │ │
│  │  [暂无事件]                                         │ │
│  │                                                     │ │
│  │  [保存到历史]  [导出 cURL]                         │ │
│  │                                                     │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

#### 核心功能

**1. WebSocket 会话管理**
- 建立 WebSocket 连接：`ws://server/ws/driverlab?driverId=xxx&runMode=xxx`
- 断开时自动终止 Driver 进程
- 会话超时自动清理（可配置）
- 支持手动重连

**2. 元数据驱动 UI 生成**
```typescript
interface DriverMeta {
  commands: CommandMeta[];
}

interface CommandMeta {
  name: string;
  params: FieldMeta[];
}

// 根据 params 自动生成输入表单
function generateCommandForm(command: CommandMeta) {
  return command.params.map(param => {
    switch (param.type) {
      case 'Int':
        return <InputNumber {...param} />;
      case 'String':
        return <Input {...param} />;
      case 'Bool':
        return <Switch {...param} />;
      // ...
    }
  });
}
```

**3. 实时消息流**
```typescript
// WebSocket 消息格式
interface WsMessage {
  type: 'meta' | 'event' | 'done' | 'error';
  data: any;
}

// 消息处理
wsClient.on('message', (msg: WsMessage) => {
  switch (msg.type) {
    case 'meta':
      // 接收 Driver 元数据
      setDriverMeta(msg.data);
      break;
    case 'event':
      // 接收中间事件
      appendEvent(msg.data);
      break;
    case 'done':
      // 接收最终结果
      setResult(msg.data);
      break;
    case 'error':
      // 接收错误
      setError(msg.data);
      break;
  }
});
```

**4. 历史记录**
- 保存每次执行的请求和响应
- 支持重放历史请求
- 按时间倒序展示
- 可导出为 JSON

**5. cURL 导出**
```bash
# 示例导出
curl -X POST http://localhost:8080/api/drivers/calc-driver/exec \
  -H "Content-Type: application/json" \
  -d '{"command":"add","params":{"a":10,"b":20}}'
```

### 7.4 进程树可视化

#### 实现方案

**数据结构**
```typescript
interface ProcessTreeNode {
  info: ProcessInfo;
  children: ProcessTreeNode[];
}

interface ProcessInfo {
  pid: number;
  name: string;
  commandLine: string;
  cpuPercent: number;
  memoryRssBytes: number;
  threadCount: number;
  // ...
}
```

**渲染策略**
- 使用递归组件
- 可折叠/展开节点
- 颜色编码（CPU/内存使用率）
- 实时更新（轮询或 WebSocket）

**组件示例**
```tsx
interface ProcessTreeNodeProps {
  node: ProcessTreeNode;
  level: number;
}

const ProcessTreeNode: React.FC<ProcessTreeNodeProps> = ({ node, level }) => {
  const [collapsed, setCollapsed] = useState(false);
  
  const cpuColor = node.info.cpuPercent > 80 ? 'red' : 
                   node.info.cpuPercent > 50 ? 'orange' : 'green';
  
  return (
    <div style={{ marginLeft: level * 20 }}>
      <div className="process-node">
        {node.children.length > 0 && (
          <button onClick={() => setCollapsed(!collapsed)}>
            {collapsed ? '▶' : '▼'}
          </button>
        )}
        <span className="pid">PID {node.info.pid}</span>
        <span className="name">{node.info.name}</span>
        <span className="cpu" style={{ color: cpuColor }}>
          CPU: {node.info.cpuPercent}%
        </span>
        <span className="memory">
          内存: {formatBytes(node.info.memoryRssBytes)}
        </span>
      </div>
      
      {!collapsed && node.children.map(child => (
        <ProcessTreeNode 
          key={child.info.pid} 
          node={child} 
          level={level + 1} 
        />
      ))}
    </div>
  );
};
```

### 7.5 实时 Dashboard

#### 数据源
- HTTP 轮询：`GET /api/server/status` (30s 间隔)
- Server-Sent Events：`GET /api/events` (实时推送)

#### 图表库选择
- **Recharts**：用于趋势图（CPU/内存）
- **统计卡片**：自定义组件

#### 示例代码
```tsx
const Dashboard: React.FC = () => {
  const [stats, setStats] = useState<ServerStats | null>(null);
  const [events, setEvents] = useState<ServerEvent[]>([]);
  
  // 定期轮询
  useEffect(() => {
    const fetchStats = async () => {
      const res = await api.get('/api/server/status');
      setStats(res.data);
    };
    
    fetchStats();
    const interval = setInterval(fetchStats, 30000);
    return () => clearInterval(interval);
  }, []);
  
  // SSE 事件流
  useEffect(() => {
    const eventSource = new EventSource('/api/events');
    
    eventSource.onmessage = (e) => {
      const event = JSON.parse(e.data);
      setEvents(prev => [event, ...prev].slice(0, 10));
    };
    
    return () => eventSource.close();
  }, []);
  
  return (
    <div>
      <StatCards stats={stats} />
      <ResourceChart data={stats?.history} />
      <ActiveInstances />
      <RecentEvents events={events} />
    </div>
  );
};
```

---

## 8. API 对接方案

### 8.1 API 客户端封装

**Axios 配置**
```typescript
// src/webui/src/api/client.ts
import axios from 'axios';
import { message } from 'antd';

const apiClient = axios.create({
  baseURL: '/api',
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// 请求拦截器
apiClient.interceptors.request.use(
  (config) => {
    // 可添加 Token
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
apiClient.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    const errorMsg = error.response?.data?.error || '请求失败';
    message.error(errorMsg);
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 8.2 API 模块化

**Services API**
```typescript
// src/webui/src/api/services.ts
import client from './client';

export const servicesApi = {
  // GET /api/services
  list: () => client.get('/services'),
  
  // GET /api/services/:id
  detail: (id: string) => client.get(`/services/${id}`),
  
  // POST /api/services
  create: (data: CreateServiceRequest) => 
    client.post('/services', data),
  
  // DELETE /api/services/:id
  delete: (id: string) => client.delete(`/services/${id}`),
  
  // POST /api/services/scan
  scan: () => client.post('/services/scan'),
  
  // GET /api/services/:id/files
  files: (id: string) => client.get(`/services/${id}/files`),
  
  // GET /api/services/:id/files/read?path=...
  fileRead: (id: string, path: string) => 
    client.get(`/services/${id}/files/read`, { params: { path } }),
  
  // POST /api/services/:id/files/write
  fileWrite: (id: string, data: FileWriteRequest) => 
    client.post(`/services/${id}/files/write`, data),
  
  // POST /api/services/:id/schema/validate
  validateSchema: (id: string, schema: any) => 
    client.post(`/services/${id}/schema/validate`, schema),
  
  // POST /api/services/:id/config/validate
  validateConfig: (id: string, config: any) => 
    client.post(`/services/${id}/config/validate`, config)
};
```

**Projects API**
```typescript
// src/webui/src/api/projects.ts
export const projectsApi = {
  list: () => client.get('/projects'),
  detail: (id: string) => client.get(`/projects/${id}`),
  create: (data: CreateProjectRequest) => client.post('/projects', data),
  update: (id: string, data: UpdateProjectRequest) => 
    client.put(`/projects/${id}`, data),
  delete: (id: string) => client.delete(`/projects/${id}`),
  
  // 运行时操作
  start: (id: string) => client.post(`/projects/${id}/start`),
  stop: (id: string) => client.post(`/projects/${id}/stop`),
  reload: (id: string) => client.post(`/projects/${id}/reload`),
  
  // 运行时状态
  runtime: (id: string) => client.get(`/projects/${id}/runtime`),
  
  // 日志
  logs: (id: string, params?: LogsQueryParams) => 
    client.get(`/projects/${id}/logs`, { params })
};
```

**Instances API**
```typescript
// src/webui/src/api/instances.ts
export const instancesApi = {
  list: () => client.get('/instances'),
  detail: (id: string) => client.get(`/instances/${id}`),
  terminate: (id: string) => client.post(`/instances/${id}/terminate`),
  
  // 进程树
  processTree: (id: string) => 
    client.get(`/instances/${id}/process-tree`),
  
  // 资源监控
  resources: (id: string) => client.get(`/instances/${id}/resources`),
  
  // 日志
  logs: (id: string, params?: LogsQueryParams) => 
    client.get(`/instances/${id}/logs`, { params })
};
```

**Drivers API**
```typescript
// src/webui/src/api/drivers.ts
export const driversApi = {
  list: () => client.get('/drivers'),
  detail: (id: string) => client.get(`/drivers/${id}`),
  scan: () => client.post('/drivers/scan')
};
```

**Server API**
```typescript
// src/webui/src/api/server.ts
export const serverApi = {
  status: () => client.get('/server/status'),
  
  // 需要新增的 API
  stats: () => client.get('/server/stats'),
  metrics: () => client.get('/server/metrics')
};
```

### 8.3 WebSocket 封装

**DriverLab WebSocket 客户端**
```typescript
// src/webui/src/api/driverlab-ws.ts
export class DriverLabWsClient {
  private ws: WebSocket | null = null;
  private listeners: Map<string, Function[]> = new Map();
  
  connect(driverId: string, runMode: string, extraArgs: string[]) {
    const params = new URLSearchParams({
      driverId,
      runMode,
      extraArgs: extraArgs.join(',')
    });
    
    this.ws = new WebSocket(`ws://localhost:8080/ws/driverlab?${params}`);
    
    this.ws.onopen = () => {
      this.emit('connected');
    };
    
    this.ws.onmessage = (e) => {
      const msg = JSON.parse(e.data);
      this.emit('message', msg);
      this.emit(msg.type, msg);
    };
    
    this.ws.onerror = (e) => {
      this.emit('error', e);
    };
    
    this.ws.onclose = () => {
      this.emit('disconnected');
    };
  }
  
  send(message: any) {
    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
      this.ws.send(JSON.stringify(message));
    }
  }
  
  exec(command: string, params: any) {
    this.send({
      type: 'exec',
      command,
      params
    });
  }
  
  cancel() {
    this.send({ type: 'cancel' });
  }
  
  disconnect() {
    if (this.ws) {
      this.ws.close();
      this.ws = null;
    }
  }
  
  on(event: string, callback: Function) {
    if (!this.listeners.has(event)) {
      this.listeners.set(event, []);
    }
    this.listeners.get(event)!.push(callback);
  }
  
  off(event: string, callback: Function) {
    const cbs = this.listeners.get(event);
    if (cbs) {
      const index = cbs.indexOf(callback);
      if (index > -1) cbs.splice(index, 1);
    }
  }
  
  private emit(event: string, ...args: any[]) {
    const cbs = this.listeners.get(event);
    if (cbs) {
      cbs.forEach(cb => cb(...args));
    }
  }
}
```

**使用示例**
```tsx
const DriverLab: React.FC = () => {
  const [client] = useState(() => new DriverLabWsClient());
  const [meta, setMeta] = useState(null);
  const [result, setResult] = useState(null);
  
  useEffect(() => {
    client.on('meta', (msg) => setMeta(msg.data));
    client.on('done', (msg) => setResult(msg.data));
    
    return () => {
      client.disconnect();
    };
  }, [client]);
  
  const handleConnect = () => {
    client.connect('calc-driver', 'keepalive', []);
  };
  
  const handleExec = (command: string, params: any) => {
    client.exec(command, params);
  };
  
  return (/* ... */);
};
```

### 8.4 Server-Sent Events 封装

**EventSource 封装**
```typescript
// src/webui/src/api/event-stream.ts
export class EventStream {
  private es: EventSource | null = null;
  private listeners: Map<string, Function[]> = new Map();
  
  connect(filters: string[] = []) {
    const params = new URLSearchParams();
    if (filters.length > 0) {
      params.set('filter', filters.join(','));
    }
    
    this.es = new EventSource(`/api/events?${params}`);
    
    this.es.onopen = () => {
      this.emit('connected');
    };
    
    this.es.onmessage = (e) => {
      const event = JSON.parse(e.data);
      this.emit('event', event);
      this.emit(event.type, event);
    };
    
    this.es.onerror = () => {
      this.emit('error');
      // 自动重连
    };
  }
  
  close() {
    if (this.es) {
      this.es.close();
      this.es = null;
    }
  }
  
  on(event: string, callback: Function) {
    if (!this.listeners.has(event)) {
      this.listeners.set(event, []);
    }
    this.listeners.get(event)!.push(callback);
  }
  
  private emit(event: string, ...args: any[]) {
    const cbs = this.listeners.get(event);
    if (cbs) {
      cbs.forEach(cb => cb(...args));
    }
  }
}
```

**使用示例**
```tsx
const Dashboard: React.FC = () => {
  const [events, setEvents] = useState<ServerEvent[]>([]);
  
  useEffect(() => {
    const stream = new EventStream();
    
    stream.on('event', (event: ServerEvent) => {
      setEvents(prev => [event, ...prev].slice(0, 50));
    });
    
    stream.connect(['project.*', 'instance.*']);
    
    return () => stream.close();
  }, []);
  
  return (/* ... */);
};
```

---

## 9. 开发规范

### 9.1 目录结构

```
src/
└── webui/                  # WebUI 工程根目录
    ├── index.html
    ├── package.json
    ├── tsconfig.json
    ├── vite.config.ts
    ├── .env.development
    ├── .env.production
    └── src/
        ├── api/            # API 客户端
        │   ├── client.ts
        │   ├── services.ts
        │   ├── projects.ts
        │   ├── instances.ts
        │   ├── drivers.ts
        │   ├── server.ts
        │   ├── driverlab-ws.ts
        │   └── event-stream.ts
        ├── assets/         # 静态资源
        │   ├── images/
        │   └── icons/
        ├── components/     # 公共组件
        │   ├── Layout/
        │   │   ├── Header.tsx
        │   │   ├── Sidebar.tsx
        │   │   └── Content.tsx
        │   ├── CodeEditor/
        │   │   └── MonacoEditor.tsx
        │   ├── SchemaEditor/
        │   │   ├── VisualEditor.tsx
        │   │   └── JsonEditor.tsx
        │   ├── ProcessTree/
        │   │   └── TreeNode.tsx
        │   ├── LogViewer/
        │   │   └── LogViewer.tsx
        │   └── ...
        ├── hooks/          # 自定义 Hooks
        │   ├── useApi.ts
        │   ├── useWebSocket.ts
        │   ├── useEventStream.ts
        │   └── usePagination.ts
        ├── pages/          # 页面组件
        │   ├── Dashboard/
        │   ├── Services/
        │   │   ├── List.tsx
        │   │   ├── Detail.tsx
        │   │   └── Create.tsx
        │   ├── Projects/
        │   ├── Instances/
        │   ├── Drivers/
        │   └── DriverLab/
        ├── stores/         # 状态管理
        │   ├── useServicesStore.ts
        │   ├── useProjectsStore.ts
        │   ├── useInstancesStore.ts
        │   └── useDriversStore.ts
        ├── types/          # TypeScript 类型定义
        │   ├── service.ts
        │   ├── project.ts
        │   ├── instance.ts
        │   └── driver.ts
        ├── utils/          # 工具函数
        │   ├── format.ts
        │   ├── validation.ts
        │   └── constants.ts
        ├── styles/         # 全局样式
        │   ├── variables.scss
        │   ├── mixins.scss
        │   └── global.scss
        ├── App.tsx
        ├── main.tsx
        └── router.tsx
```

### 9.2 命名规范

**文件命名**
- 组件：PascalCase（如 `ServiceList.tsx`）
- Hooks：camelCase（如 `useServiceList.ts`）
- 工具函数：camelCase（如 `formatDate.ts`）
- 样式文件：kebab-case（如 `service-list.module.scss`）

**变量命名**
- 组件：PascalCase（如 `ServiceList`）
- 函数：camelCase（如 `fetchServices`）
- 常量：UPPER_SNAKE_CASE（如 `API_BASE_URL`）
- 类型：PascalCase（如 `ServiceInfo`）

**CSS 类名**
- BEM 命名法：`block__element--modifier`
- 示例：`service-card__title--active`

### 9.3 TypeScript 规范

**类型定义**
```typescript
// 接口命名以 I 开头（可选）
interface IServiceInfo {
  id: string;
  name: string;
  version: string;
}

// 类型别名使用 PascalCase
type ServiceStatus = 'active' | 'inactive';

// 泛型使用单个大写字母或描述性名称
function fetchData<T>(url: string): Promise<T>;

// 避免使用 any，使用 unknown 或具体类型
const data: unknown = JSON.parse(text);
```

**严格模式**
```typescript
// src/webui/tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true
  }
}
```

### 9.4 组件规范

**函数组件**
```tsx
import React, { useState, useEffect } from 'react';

interface ServiceListProps {
  filter?: string;
  onSelect?: (id: string) => void;
}

export const ServiceList: React.FC<ServiceListProps> = ({ 
  filter, 
  onSelect 
}) => {
  const [services, setServices] = useState<ServiceInfo[]>([]);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // 加载数据
  }, [filter]);
  
  return (
    <div className="service-list">
      {/* 渲染逻辑 */}
    </div>
  );
};
```

**性能优化**
- 使用 `React.memo` 避免不必要的重渲染
- 使用 `useMemo` 缓存计算结果
- 使用 `useCallback` 缓存回调函数
- 使用虚拟滚动处理大列表

### 9.5 状态管理规范（Zustand）

```typescript
// src/webui/src/stores/useServicesStore.ts
import create from 'zustand';
import { servicesApi } from '../api/services';

interface ServicesState {
  services: ServiceInfo[];
  loading: boolean;
  error: string | null;
  
  fetchServices: () => Promise<void>;
  createService: (data: CreateServiceRequest) => Promise<void>;
  deleteService: (id: string) => Promise<void>;
}

export const useServicesStore = create<ServicesState>((set) => ({
  services: [],
  loading: false,
  error: null,
  
  fetchServices: async () => {
    set({ loading: true, error: null });
    try {
      const res = await servicesApi.list();
      set({ services: res.data, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
    }
  },
  
  createService: async (data) => {
    try {
      await servicesApi.create(data);
      // 重新加载列表
      await useServicesStore.getState().fetchServices();
    } catch (error) {
      set({ error: error.message });
    }
  },
  
  deleteService: async (id) => {
    try {
      await servicesApi.delete(id);
      set((state) => ({
        services: state.services.filter(s => s.id !== id)
      }));
    } catch (error) {
      set({ error: error.message });
    }
  }
}));
```

### 9.6 代码审查 Checklist

**提交前检查**
- [ ] 代码格式化（Prettier）
- [ ] 无 ESLint 错误
- [ ] 无 TypeScript 错误
- [ ] 无 console.log 残留
- [ ] 添加必要注释
- [ ] 组件可复用性
- [ ] 性能优化
- [ ] 错误处理
- [ ] 单元测试通过

---

## 10. 部署方案

### 10.1 构建配置

**Vite 配置**
```typescript
// src/webui/vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      },
      '/ws': {
        target: 'ws://localhost:8080',
        ws: true
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom', 'react-router-dom'],
          antd: ['antd'],
          charts: ['recharts'],
          monaco: ['monaco-editor']
        }
      }
    }
  }
});
```

### 10.2 环境变量

**src/webui/.env.development**
```bash
VITE_API_BASE_URL=http://localhost:8080
VITE_WS_BASE_URL=ws://localhost:8080
```

**src/webui/.env.production**
```bash
VITE_API_BASE_URL=/
VITE_WS_BASE_URL=ws://example.com
```

### 10.3 部署架构

**方案1：嵌入式部署（推荐）**
```
stdiolink_server
├── server (C++ 二进制)
│   └── 启动 HTTP 服务
├── webui/ (前端静态文件)
│   ├── index.html
│   ├── assets/
│   └── ...
└── 通过 /webui 路径访问
```

**实现方式**
- WebUI 源码目录放在 `src/webui/`
- 前端构建产物放入部署目录 `webui/`
- 后端添加静态文件服务路由
- 访问 `http://localhost:8080/` 自动跳转到 `/webui/`

**方案2：独立部署**
```
[Nginx] ──┬──> /api/* ──> stdiolink_server:8080
          ├──> /ws/* ──> stdiolink_server:8080
          └──> /* ──> WebUI (静态文件)
```

**Nginx 配置**
```nginx
server {
    listen 80;
    server_name localhost;
    
    # WebUI 静态文件
    location / {
        root /var/www/stdiolink-webui;
        try_files $uri $uri/ /index.html;
    }
    
    # API 代理
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    
    # WebSocket 代理
    location /ws/ {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # SSE 代理
    location /api/events {
        proxy_pass http://localhost:8080;
        proxy_set_header Connection '';
        proxy_http_version 1.1;
        chunked_transfer_encoding off;
        proxy_buffering off;
        proxy_cache off;
    }
}
```

### 10.4 Docker 部署

**Dockerfile（多阶段构建）**
```dockerfile
# 阶段1：构建前端
FROM node:18-alpine AS frontend-builder
WORKDIR /app/src/webui
COPY src/webui/package*.json ./
RUN npm ci
COPY src/webui/ ./
RUN npm run build

# 阶段2：后端运行时
FROM ubuntu:22.04
WORKDIR /app

# 复制后端二进制（假设已编译）
COPY stdiolink_server /app/stdiolink_server

# 复制前端构建产物
COPY --from=frontend-builder /app/src/webui/dist /app/webui

# 暴露端口
EXPOSE 8080

# 启动服务
CMD ["/app/stdiolink_server", "--port=8080", "--host=0.0.0.0"]
```

**docker-compose.yml**
```yaml
version: '3.8'

services:
  stdiolink:
    build: .
    ports:
      - "8080:8080"
    volumes:
      - ./data:/app/data
    environment:
      - LOG_LEVEL=info
    restart: unless-stopped
```

### 10.5 CI/CD 流程

**GitHub Actions 示例**
```yaml
name: Build and Deploy

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci --prefix src/webui
      
      - name: Run tests
        run: npm test --prefix src/webui
      
      - name: Build
        run: npm run build --prefix src/webui
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: webui-dist
          path: src/webui/dist/
  
  deploy:
    needs: build
    runs-on: ubuntu-latest
    
    steps:
      - name: Download artifacts
        uses: actions/download-artifact@v3
        with:
          name: webui-dist
      
      - name: Deploy to server
        # 部署逻辑（SSH、SCP等）
        run: |
          echo "Deploying to production..."
```

---

## 11. 附录

### 11.1 API 清单

#### 现有 API（已实现）

**Services**
- `GET /api/services` - 列表
- `GET /api/services/:id` - 详情
- `POST /api/services` - 创建
- `DELETE /api/services/:id` - 删除
- `POST /api/services/scan` - 扫描目录
- `GET /api/services/:id/files` - 文件列表
- `GET /api/services/:id/files/read?path=xxx` - 读取文件
- `POST /api/services/:id/files/write` - 写入文件
- `POST /api/services/:id/files/create` - 创建文件
- `DELETE /api/services/:id/files/delete?path=xxx` - 删除文件
- `POST /api/services/:id/schema/validate` - 验证 Schema
- `POST /api/services/:id/schema/defaults` - 生成默认配置
- `POST /api/services/:id/config/validate` - 验证配置

**Projects**
- `GET /api/projects` - 列表
- `GET /api/projects/:id` - 详情
- `POST /api/projects` - 创建
- `PUT /api/projects/:id` - 更新
- `DELETE /api/projects/:id` - 删除
- `POST /api/projects/:id/validate` - 验证项目
- `POST /api/projects/:id/start` - 启动
- `POST /api/projects/:id/stop` - 停止
- `POST /api/projects/:id/reload` - 重载
- `GET /api/projects/:id/runtime` - 运行时状态
- `PUT /api/projects/:id/enabled` - 启用/禁用
- `GET /api/projects/:id/logs` - 日志
- `POST /api/projects/runtime/batch` - 批量运行时状态

**Instances**
- `GET /api/instances` - 列表
- `GET /api/instances/:id` - 详情
- `POST /api/instances/:id/terminate` - 终止
- `GET /api/instances/:id/logs` - 日志
- `GET /api/instances/:id/process-tree` - 进程树
- `GET /api/instances/:id/resources` - 资源使用

**Drivers**
- `GET /api/drivers` - 列表
- `GET /api/drivers/:id` - 详情
- `POST /api/drivers/scan` - 扫描目录

**Server**
- `GET /api/server/status` - 服务器状态

**Event Stream**
- `GET /api/events?filter=xxx,yyy` - SSE 事件流

**DriverLab WebSocket**
- `GET /ws/driverlab?driverId=xxx&runMode=xxx&extraArgs=xxx` - WebSocket 连接

#### 需要新增的 API

**Server Stats**（用于 Dashboard）
```typescript
GET /api/server/stats

Response:
{
  "timestamp": "2026-02-13T10:30:00Z",
  "uptime": 86400,  // 秒
  "resources": {
    "cpu": {
      "percent": 12.5,
      "cores": 8
    },
    "memory": {
      "total": 16777216000,
      "used": 8388608000,
      "percent": 50.0
    },
    "processes": 23
  },
  "counts": {
    "services": 12,
    "projects": 8,
    "projectsEnabled": 5,
    "instances": 5,
    "drivers": 18
  },
  "history": [
    {
      "timestamp": "2026-02-13T10:25:00Z",
      "cpu": 10.2,
      "memory": 7516192768
    },
    // ... 最近1小时数据
  ]
}
```

**Instance Resources（历史数据）**
```typescript
GET /api/instances/:id/resources?from=xxx&to=xxx

Response:
{
  "instanceId": "inst-001",
  "data": [
    {
      "timestamp": "2026-02-13T10:25:00Z",
      "cpu": 12.3,
      "memoryRss": 268435456,
      "threads": 8,
      "ioRead": 1024000,
      "ioWrite": 512000
    },
    // ...
  ]
}
```

### 11.2 数据模型定义

**ServiceInfo**
```typescript
interface ServiceInfo {
  id: string;                // 服务ID
  name: string;              // 名称
  version: string;           // 版本
  description?: string;      // 描述
  entryScript: string;       // 入口脚本
  schema: ConfigSchema;      // 配置Schema
  createdAt: string;         // 创建时间（ISO 8601）
  updatedAt: string;         // 更新时间（ISO 8601）
  projectCount: number;      // 引用项目数
}
```

**Project**
```typescript
interface Project {
  id: string;
  name: string;
  serviceId: string;
  enabled: boolean;
  schedule: Schedule;
  config: Record<string, any>;
  valid: boolean;
  error?: string;
  createdAt: string;
  updatedAt: string;
}

interface Schedule {
  type: 'Manual' | 'FixedRate' | 'Daemon';
  intervalMs?: number;       // FixedRate 专用
  maxConcurrent?: number;    // FixedRate 专用
  restartDelayMs?: number;   // Daemon 专用
  maxConsecutiveFailures?: number; // Daemon 专用
}
```

**Instance**
```typescript
interface Instance {
  id: string;
  projectId: string;
  serviceId: string;
  pid: number;
  status: 'running' | 'stopped' | 'starting' | 'restarting';
  startedAt: string;
  workingDirectory: string;
  logPath: string;
  commandLine: string[];
}
```

**DriverInfo**
```typescript
interface DriverInfo {
  id: string;
  name: string;
  version: string;
  description?: string;
  vendor?: string;
  entryPoint: string;        // 如 "./calc --stdio"
  capabilities: string[];
  profiles: string[];
  commands: CommandMeta[];
  configSchema?: ConfigSchema;
}
```

**ProcessInfo**
```typescript
interface ProcessInfo {
  pid: number;
  parentPid: number;
  name: string;
  commandLine: string;
  status: 'running' | 'sleeping' | 'zombie' | 'stopped' | 'unknown';
  startedAt: string;
  cpuPercent: number;
  memoryRssBytes: number;
  memoryVmsBytes: number;
  threadCount: number;
  uptimeSeconds: number;
  ioReadBytes: number;
  ioWriteBytes: number;
}

interface ProcessTreeNode {
  info: ProcessInfo;
  children: ProcessTreeNode[];
}

interface ProcessTreeSummary {
  totalProcesses: number;
  totalCpuPercent: number;
  totalMemoryRssBytes: number;
  totalThreads: number;
}
```

### 11.3 错误码规范

| 错误码 | HTTP 状态码 | 说明 |
|--------|------------|------|
| 400 | Bad Request | 请求参数错误 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突（如ID已存在） |
| 422 | Unprocessable Entity | 业务逻辑错误（如配置验证失败） |
| 500 | Internal Server Error | 服务器内部错误 |

**错误响应格式**
```json
{
  "error": "Service with ID 'xxx' not found"
}
```

### 11.4 性能指标

**目标**
- 页面加载时间：< 2s
- API 响应时间：< 200ms (p95)
- WebSocket 消息延迟：< 50ms
- 首屏渲染：< 1s
- 交互响应：< 100ms

**优化策略**
- 代码分割（按路由）
- 懒加载（Monaco Editor 等大组件）
- 虚拟滚动（大列表）
- 节流/防抖（搜索、滚动）
- Service Worker（可选）

### 11.5 安全考虑

**前端**
- 输入验证（防 XSS）
- CSRF Token（如需）
- Content Security Policy
- 敏感信息不存储在前端

**后端**
- CORS 限制
- API 速率限制
- 输入验证与清理
- 权限控制（如需）

### 11.6 未来扩展方向

1. **多语言支持**（i18n）
2. **暗色模式**
3. **用户权限管理**（RBAC）
4. **审计日志**
5. **通知中心**
6. **移动端适配**
7. **插件系统**
8. **集成第三方监控**（Prometheus、Grafana）

---

## 📝 结语

本设计文档详尽描述了 stdiolink_server WebUI 的产品设计方案，涵盖了从技术栈选型、界面设计、功能模块到开发规范和部署方案的方方面面。

**核心亮点**：
1. **专业的企业级 UI 设计**：遵循现代设计规范，色彩克制、布局清晰
2. **完整的功能覆盖**：Service、Project、Instance、Driver 全生命周期管理
3. **强大的开发工具**：Monaco 编辑器、Schema 可视化、DriverLab 在线测试
4. **实时监控与可视化**：进程树、资源图表、日志流、事件流
5. **明确的技术栈与规范**：React + TypeScript + Ant Design，保证代码质量

**下一步**：
- 搭建项目脚手架
- 实现核心布局（Header + Sidebar + Content）
- 逐模块开发（Dashboard → Services → Projects → Instances → Drivers → DriverLab）
- 集成测试与优化
- 部署上线

如有任何疑问或需要进一步细化，请随时反馈！

---

**文档版本**：1.0  
**最后更新**：2026-02-13  
**联系方式**：[待补充]
