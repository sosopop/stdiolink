# DriverLab 交互调试

DriverLab 是 WebUI 内置的 Driver 实时调试工具，通过 WebSocket 与 Driver 进程双向通信，支持命令发送、响应查看和协议流分析。

## 界面布局

```
┌──────────────────────────────────────────────────┐
│  连接面板：选择 Driver · 运行模式 · 连接/断开     │
├────────────────────┬─────────────────────────────┤
│  命令面板          │  协议流查看器                │
│  · 命令列表        │  · 请求/响应消息流           │
│  · 参数表单        │  · 展开/折叠 JSON            │
│  · 执行按钮        │  · 自动滚动                  │
├────────────────────┴─────────────────────────────┤
│  状态栏：连接状态 · PID · 元数据信息              │
└──────────────────────────────────────────────────┘
```

## 连接流程

1. 在连接面板选择目标 Driver
2. 选择运行模式：`oneshot`（单次）或 `keepalive`（保活）
3. 点击连接，WebUI 通过 WebSocket 连接到后端
4. 后端启动 Driver 进程，返回元数据和命令列表
5. 命令面板自动填充可用命令

## WebSocket 协议

连接地址：`ws://{host}/api/driverlab/{driverId}?runMode={mode}`

### 客户端发送

```json
// 执行命令
{"type": "exec", "cmd": "command_name", "data": {"param": "value"}}

// 取消执行
{"type": "cancel"}
```

### 服务端推送

| type | 说明 |
|------|------|
| `driver.started` | Driver 进程已启动 |
| `driver.restarted` | Driver 进程已重启（OneShot 模式） |
| `meta` | 元数据（命令列表、参数定义） |
| `stdout` | Driver 的 JSONL 响应输出 |
| `driver.exited` | Driver 进程已退出 |
| `error` | 错误信息 |

## 功能特性

- **命令面板**：根据元数据自动生成参数表单，支持类型校验
- **协议流查看器**：按时间顺序展示所有请求和响应消息，最多保留 500 条
- **消息操作**：导出消息记录、清空消息、复制单条消息
- **自动滚动**：新消息到达时自动滚动到底部，可手动关闭
- **状态指示**：实时显示连接状态（connected / connecting / disconnected / error）
